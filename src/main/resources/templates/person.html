<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>个人中心 - 美食鉴赏系统</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f8f8f8;
        }

        header {
            background-color: #4caf50;
            color: #fff;
            padding: 15px;
            text-align: center;
        }

        nav {
            background-color: #333;
            overflow: hidden;
        }

        nav a {
            float: left;
            display: block;
            color: #fff;
            text-align: center;
            padding: 14px 16px;
            text-decoration: none;
        }

        nav a.logout {
            float: right;
        }

        section {
            display: flex;
        }

        aside {
            width: 7%;
            padding-right: 20px;
        }

        main {
            width: 90%;
        }

        button {
            background-color: #4caf50;
            color: #fff;
            border: none;
            padding: 10px;
            border-radius: 4px;
            cursor: pointer;
            margin-bottom: 10px;
        }


        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        table, th, td {
            border: 1px solid #ddd;
        }

        th, td {
            padding: 12px;
            text-align: left;
        }

        img {
            width: 100px;
            height: auto;
            aspect-ratio: 1/1; /* CSS Aspect Ratio property, if supported */
        }

    </style>
</head>
<body>

<header>
    <h1>全国美食鉴赏系统</h1>
</header>

<nav>
    <a href="./list.html" th:href="@{./main}">主页</a>
    <a onclick="showUserInfo()">个人信息</a>
    <a href="./add" th:action="@{./add}">增加数据</a>
    <a href="#" class="logout" onclick="logout()">退出登录</a>
</nav>

<section>
    <aside>
        <!-- 左侧栏 -->
        <h2>用户操作</h2>
        <label for="image-input">
        <button onclick="clickUpload()">上传头像</button>
        </label>
        <input type="file" id="image-input" style="display: none" onchange="uploadUserImage()">
        <button onclick="queryData()">查询数据</button>

    </aside>

    <main>
        <!-- 右侧栏 -->
        <h2>用户添加的所有数据</h2>
        <table id="userData">
            <!-- 用户数据将显示在这里 -->
        </table>
        <div id="result"></div>
    </main>
</section>

<script>
    function clickUpload() {
        // Event.preventDefault();
        var fileInput = document.getElementById('image-input');
        fileInput.click(); // 手动触发文件输入框的点击事件
    }

    function uploadUserImage() {
        var fileInput = document.getElementById('image-input');
        var file = fileInput.files[0];

        if (file) {
            var formData = new FormData();
            formData.append('image', file);

            var xhr = new XMLHttpRequest();
            xhr.open('POST', '/uploadUserImage', true);

            // 处理上传完成后的回调
            xhr.onload = function () {
                if (xhr.status === 200) {
                    document.getElementById('result').innerHTML = '上传成功!';
                } else {
                    document.getElementById('result').innerHTML = '上传失败!';
                }
            };

            // 发送请求
            xhr.send(formData);
        } else {
            alert('请选择要上传的图片');
        }
    }

    function queryData() {
        // 使用 Fetch API 发起查询数据的异步请求
        fetch('https://api.example.com/query-data')
            .then(response => response.json())
            .then(data => {
                // 处理查询结果
                displayQueryResult(data);
            })
            .catch(error => console.error('Error querying data: ', error));
    }



    function logout() {
        // 实现退出登录的逻辑
        alert('退出登录成功'); // 这里可以替换成实际的退出登录操作
    }
    function showUserInfo() {
        // 使用 Fetch API 发起获取用户信息的异步请求
        fetch('/getUserInfo')
            .then(response => response.json())
            .then(user => {
                // 处理获取的用户信息
                displayUserInfo(user);
            })
            .catch(error => console.error('Error fetching user info: ', error));
    }




    function displayUserInfo(user) {
        // 渲染用户信息到页面上
        var mainContent = document.getElementById('userData');
        mainContent.innerHTML = ''; // 清空表格内容

        // 创建一个包含单行的表格
        var table = document.createElement('table');
        var tbody = table.createTBody();


        // 遍历用户信息
        for (var key in user) {
            var tr = tbody.insertRow();
            // 创建表格单元格

            switch (key) {
                case "name":
                    var th = tr.insertCell();
                    th.innerHTML = '名字';
                    // 创建表格值单元格
                    var td = tr.insertCell();
                    td.innerHTML = user[key];
                    break;
                case "username":
                    var th = tr.insertCell();
                    th.innerHTML = '用户名';
                    // 创建表格值单元格
                    var td = tr.insertCell();
                    td.innerHTML = user[key];
                    break;
                case "userimagepath":
                    var th = tr.insertCell();
                    th.innerHTML = '用户头像';
                    // 创建表格值单元格
                    var td = tr.insertCell();
                    td.innerHTML = `<img src="${user[key]}" alt="用户头像">`;
                    //td.innerHTML = `<img src="${user[key]}" alt="用户头像" style="width: 50px; height: 50px;">`;
                    break;

            }

        }

        // 将表格添加到主内容区域
        mainContent.appendChild(table);

        // 显示结果区域
        var resultArea = document.getElementById('result');
        resultArea.innerHTML = '个人信息加载成功!';
    }
</script>
</body>
</html>
